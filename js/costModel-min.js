var gCacheOn=true;var UIForm="global";var gLoadXML=false;var gLoadValues=false;if(gLoadXML){loadUIModel_XML(function(a){UIForm=$.xml2json(a)})}else{loadUIModel_JSON(function(a){UIForm=a})}function check_value(a){return gLoadValues?a:0}function hide_loading(){$("#loading").hide()}function show_loading(){$("#loading").show()}var section={parentHook:"",myHook:"section",numSections:0,setParentHook:function(a){this.parentHook=a;return},getMyHook:function(){var a=$("."+this.myHook+":last");return(typeof(a[0])=="undefined"?null:a[0])},newMarkup:function(a){this.numSections++;return'<fieldset class="'+this.myHook+" "+rowhdr.parentHook+'" title="Tab '+this.numSections+'" id="'+this.numSections+'"><legend>'+a.text[0]+"</legend></fieldset>"},insert:function(b){var a=this.newMarkup(b);$("."+this.parentHook+":last").append(a)}};var subsectionhdr={parentHook:section.myHook,myHook:"subsectionhdr",getMyHook:function(){var a=$("."+this.myHook+":last");return(typeof(a[0])=="undefined"?null:a[0])},newMarkup:function(a){return'<div class="'+this.myHook+'"></div>'},insert:function(b){var a=this.newMarkup(b);$("."+this.parentHook+":last").append(a)}};var subsection={parentHook:subsectionhdr.myHook,myHook:"subsection",numSubSections:0,getMyHook:function(){var a=$("."+this.myHook+":last");return(typeof(a[0])=="undefined"?null:a[0])},newMarkup:function(a){this.numSubSections++;return'<h3><a href="#">'+a.text[0]+'</a></h3><div class="'+this.myHook+" "+rowhdr.parentHook+'"></div>'},insert:function(c){var b=$("."+subsectionhdr.parentHook+":last ."+subsectionhdr.myHook+":last")[0];if(b==undefined){subsectionhdr.insert(c)}var a=this.newMarkup(c);$("."+this.parentHook+":last").append(a)}};var rowhdr={parentHook:"rowhdrparent",myHook:"rowhdr",getMyHook:function(){var a=$("."+this.myHook+":last");return(typeof(a[0])=="undefined"?null:a[0])},newMarkup:function(a){return'<tr class="'+this.myHook+'"></tr>'},insertTable:function(a){$("."+this.parentHook+":last").append('<table><tbody class="'+this.parentHook+'"></tbody></table>');return},insert:function(b){var c=$("div."+this.parentHook+":last table:last")[0];if(c==undefined){this.insertTable(b)}var a=this.newMarkup(b);$("."+this.parentHook+":last").append(a)}};var rowdata={parentHook:"rowhdr",myHook:"rowdata",fSelect:false,fLastRowConcat:false,nCellNum:0,col:[[{col1:"col4-1",col2:"col4-2"}],[{col1:"col4-1",col2:"col4-2"},{col1:"col4-3",col2:"col4-4"}]],newCellId:function(a){if(a==undefined){a="ZZ"}return a+(++this.nCellNum)},getMyHook:function(){var a=$("."+this.myHook+":last");return(typeof(a[0])=="undefined"?null:a[0])},insert:function(d){var b="";var a,c;if(!this.fLastRowConcat&&!this.fSelect){rowhdr.insert(d)}if(!this.fSelect){c=(d.concat=="yes");a=this.col[+(this.fLastRowConcat||c)][+(this.fLastRowConcat)];b+='<td class="'+a.col1+'"> </td> <td class="'+a.col2+'"></td>';$("."+this.parentHook+":last").append(b);this.fLastRowConcat=(d.concat=="yes")}else{a=this.col[0][0]}this._insertRowData(d,a)},_insertRowData:function(l,g){var h=$("."+g.col1+":last");var f=$("."+g.col2+":last");var i=$("tr:last");var e;var m="",d="";var j="";if(h==undefined||f==undefined){return}if(typeof(l.text)=="undefined"||l.text[0]==undefined){e=""}else{e=l.text[0]}if(typeof(l.help)!="undefined"){j=newHelpMarkup(l.help)}switch(l.type){case"unitcost":var k=$(".rowhdr:last");var c=this.newCellId(),b=this.newCellId(),a=this.newCellId();if(typeof(l.text)=="undefined"||l.text[0]==undefined){h.append('<input class="userInput cell" id="CELL_'+a+'" type="text" value=" "></input>'+j)}else{h.addClass("sum1").append(l.text[0]+j)}f.removeClass(function(){return f.attr("class")});f.addClass("sum2").addClass("numInput").addClass("data").append('Cost/Unit: <input class="smallNum numInput cell" type="text" id="CELL_'+c+'" value="0"></input>');k.append('<td class="sum2 numInput data">Quantity: <input class="smallNum numInput cell" type="text" id="CELL_'+b+'" value="0"></input>');k.append('<td class="numCalc smallNum data">Total: <input disabled="disabled" style="border: none;" title="='+c+"*"+b+'" type="text" id="CELL_'+l.id+'" value="'+check_value(l.value)+'" class="cell currency '+l.inputClass+" "+l.type+'"></input></td>');break;case"numInput":h.addClass(l.textClass);h.append(e+j);f.addClass(l.type).addClass(l.inputClass).addClass("data").append('<input type="text" title="'+check_value(l.value)+'" id="CELL_'+l.id+'" value="'+check_value(l.value)+'" class="'+l.inputClass+" "+l.type+'"></input>');break;case"numCalc":h.addClass(l.textClass);h.append(e+j);f.addClass(l.type).addClass(l.inputClass).addClass("data").append('<input disabled="disabled" style="border: none;" title="'+l.calc+'" type="text" id="CELL_'+l.id+'" value="'+check_value(l.value)+'" class="cell '+l.inputClass+" "+l.type+'"></input>');break;case"label":h.append(e+j).addClass(l.type).addClass(l.textClass);h.attr("COLSPAN","2");f.addClass("hidden");break;case"select":this.fSelect=true;h.append(e+j);f.addClass(l.type).append('<div class="selectDiv"><div class="box"><div class="value"><select class="selectTag" title="'+e+'"><option>-No Selection-</option>');break;case"option":$("select.selectTag:last").append("<option>"+e+"</option>");break;case"endSelect":this.fSelect=false;break}return}};function formatNumbers(){$("input.numInput").add("input.numCalc").each(function(){var b,a;if($(this).hasClass("numInput")){b=parseFloat($(this).attr("title"))}else{b=parseFloat($(this).attr("value"))}if(isNaN(b)){return}b=Math.round(100*b);if($(this).hasClass("percent")){$(this).attr("value",b.toFixed(0)+"%")}else{b=b/100;if(b==Math.round(b)){a=b}else{a=(b/100).toFixed(2)}if($(this).hasClass("currency")){a="$"+a}$(this).attr("value",a)}})}jQuery.fn.forceNumeric=function(){return this.each(function(){$(this).keydown(function(b){var a=b.which||b.keyCode;if(!b.shiftKey&&!b.altKey&&!b.ctrlKey&&a>=48&&a<=57||a>=96&&a<=105||a==190||a==188||a==109||a==8||a==9||a==13||a==35||a==36||a==37||a==39||a==46||a==45){return true}return false})})};function test_chunks(){var a;build_cache("input");a=JSON.stringify(cells_cache);save_cookie_chunks("test",a);restore_cookie_chunks("test")}function save_cookie_chunks(f,j){var b=0,d,e;var k=350;var a=j.replace(/,/g,"\\,");var g=a.length;var m=Math.floor(g/k)+(g%k==0?0:1);for(var c=0;c<m;c++){e=f+c;d=k;if(a[b+d-1]=="\\"){d--}$.cookie(e,a.substring(b,b+d-1),{raw:true,expires:14});b+=d-1}}function restore_cookie_chunks(c){var e="",b,a=0;var d=true;while(d){b=$.cookie(c+a);if(b==null){d=false}else{e+=b}a++}return e.replace(/\\/g,"")}function read_cookie_chunks(a){}function build_and_save_cache(){var b;build_cache("input");b=JSON.stringify(cells_cache);if(b==undefined){return}save_cookie_chunks("cells",b);var a=[];$(".selectTag").each(function(d,e){var c;if(jQuery.browser.msie==undefined){c=$(this).linkselect("val")}else{c=e.value}if(c!=undefined&&typeof(c)=="string"){a.push(c)}});b=JSON.stringify(a);$.cookie("select_cache",b,{expires:14});return}function restore_cache(){var d=undefined;var a=[],b=0;d=restore_cookie_chunks("cells");if(d!=undefined&&typeof(d)=="string"&&d!=""){try{jQuery.each(JSON.parse(d),function(e,f){set_cell_value(e,f)})}catch(c){}}d=$.cookie("select_cache");if(d==""||!d){return}a=JSON.parse(d);$(".selectTag").each(function(){$(this).linkselect("val",a[b++])})}function show_hidden(){$(".hidden").each(function(){$(this).removeClass("hidden")})}function CreateUIForm(c){var k=0,e="";var m=0,d=true;var l,a="",j=true;var b,h=0,g=undefined;section.setParentHook(c);for(var f=0;f<UIForm.UIElement.length;f++){l=UIForm.UIElement[f];if(typeof(l)=="undefined"){continue}if(typeof(l.value)=="undefined"){l.value=0}switch(l.type){case"section":section.insert(l);break;case"subsection":subsection.insert(l);break;default:rowdata.insert(l);break}}$("."+subsectionhdr.myHook).accordion({autoHeight:false});$("select.selectTag").linkselect();$("#tabs").stepy({titleClick:true});hide_loading();setTimeout(setup_part2,500);return}function setup_part2(){$("fieldset[title]").each(function(){$(this).removeAttr("title")});$(".help, img[title]").tooltip({position:"top right",opacity:0.7});$(".numInput").forceNumeric();$(".numInput").add(".numCalc").blur(function(){var a=this.value;this.title=a.replace(/,/g,"");evaluate_cells("input");formatNumbers();return});$(".userInput").blur(function(){this.title=this.value});if(gCacheOn){restore_cache();setInterval(build_and_save_cache,15000)}$(".numInput").add(".numCalc").focus(function(){this.value=this.title;return});show_loading();evaluate_cells("input");formatNumbers();hide_loading();return}function newHelpMarkup(a){return'   <img width="30" height="20" class="help" src="images/small_question_mark.jpg" title="'+a+'" />'};